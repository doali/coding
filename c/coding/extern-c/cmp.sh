#!/usr/bin/env bash

set -x

# ------------------------------------------------------------------------------
# Nettoyage
# ------------------------------------------------------------------------------
rm *.o *.exe *.a 2>/dev/null

# ------------------------------------------------------------------------------
# Creation des fichiers objets (.o)
# G++
# ------------------------------------------------------------------------------
g++ -c main.cpp
g++ -c A.cpp
g++ -c B.cpp

# ------------------------------------------------------------------------------
# Creation du fichier object (.o)
# GCC
# ------------------------------------------------------------------------------
gcc -c ctool.c
# ------------------------------------------------------------------------------
# Creation d'une lib static
# ------------------------------------------------------------------------------
# terminal@console & nm ctool.o
# terminal@console & nm libctool.a
# ------------------------------------------------------------------------------
ar -q libctool.a ctool.o

# ------------------------------------------------------------------------------
#g++ -o main.exe main.o A.o B.o ctool.o # fonctionne, mais ctool.c est compile avec g++ et non gcc
# ------------------------------------------------------------------------------
# des différences sont à noter entre C et C++ concernant les struct par exemples
# => il faut etre vigilant
# => peut-être faudrait-il mieux compiler avec gcc et l'indiquer à la phase de l'édition des liens
#    avec extern "C" { ... } dans le code cpp
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# Edition des liens
# G++
# ------------------------------------------------------------------------------
g++ -o main.exe main.o A.o B.o libctool.a
