#!/usr/bin/env bash

# ------------------------------------------------------------------------------
# (0) : clean
# ------------------------------------------------------------------------------
./cmd_clean 2>/dev/null

# ------------------------------------------------------------------------------
# (1) : [preprocessor] => .i
# ------------------------------------------------------------------------------
cpp main.c >main.i

# ------------------------------------------------------------------------------
# (2) : assemblee code => .s
# ------------------------------------------------------------------------------
gcc -S main.i 

# ------------------------------------------------------------------------------
# (3) : object code => .o
as -o main.o main.s 
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# ar : archive object (static lib) => .a
gcc -c libread.c
ar -q libread.a libread.o
# ------------------------------------------------------------------------------

# ------------------------------------------------------------------------------
# INFO : interface with nm
# ------------------------------------------------------------------------------
#nm main.o 
#nm -a main.o 

# ------------------------------------------------------------------------------
# INFO : interface with readelf
# ------------------------------------------------------------------------------
readelf -s main.o
#readelf -a main.o

# ------------------------------------------------------------------------------
# (4) : linked (ld) => .exe
# ------------------------------------------------------------------------------
gcc -o main.exe main.o libread.a

# ------------------------------------------------------------------------------
# INFO : dependencies
# ------------------------------------------------------------------------------
#ldd main.o
ldd main.exe

# ------------------------------------------------------------------------------
# RUN
# ------------------------------------------------------------------------------
#./main 
